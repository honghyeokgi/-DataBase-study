## 🛢 데이터베이스 트랜잭션

--------------------------------------------------------------------------------

### 트랜잭션 : 한 묶음으로 처리되어야   하는 SQL 명령문들의 집합

- 트랜잭션에 속한 SQL 명령문들은 모두 정상 처리되어야 함께 완료되며 하나의 명령문이라도 오류가 발생하면 전체를 취소함



1. COMMIT : 정상종료

   - 트랜잭션의 실행 결과를 데이터베이스에 최종적으로 반영하는것
   - 임시로 실행 처리한 트랜잭션의 실행 결과를 실제 데이터베이스에 반영하는 명령

2. 롤백(rollback) : 

   - 실행 결과를 반영하지 않고 취소하여 원래 상태로 되돌리는것
   - 롤백이 가능하므로 커밋되기 전까지는 데이터베이스에 완전하게 반영되었다고 확신 할 수 없는 임시 실행 결과일 뿐

   ```mysql
   start transaction
   
   SQL
   +
   SQl
   
   COMMIT
   ```

   와 같이 start transaction 안에 n개의 SQL을 감싸고 COMMIT로 적용한다.



트랜잭션의 특성

1. 원자성 (Atomicity): 트랜잭션 안의 sql명ㄹㅇ문을 모두 성공적으로 실행하여 완료하거나 아니면 모두 철회하여 무효화해야함을 의미
   - 전부 혹은 전무 실행규칙을 적용
   - 만약 장애가 발생한다면 장애 발생 시점에 이미 정상 오나료되어 커밋된 트랜잭션은 제외하고 완료되지 않은 트랜잭션은 모두 취소시킴
2. 일관성 (Consistency) : 데이터베이스가 트랜잭션 실행 전의 일관된 상태에서 트랜잭션 수행 후에도 또 다른 일관된 상태로 전환되어야함을 의미
3. 독립성 (Isolation) : 커밋될 때까지 트랜잭션이 수행한 임시 실행 결과가 다른 트랜잭션에게 공개되지 않아야함을 의미
4. 지속성 (Durability) : 일단 트랜잭션이 커밋되며 그 트랜잭션의 실행 결과는 장애가 발생하더라도 보존되어야함을 의미



트랜잭션의 종류

1.명시적 트랜잭션 : 트랜잭션의 시작과 끝을 사용자가 직접 명시적으로 지정하는 트랜잭션

```mysql
START TRANSACTION;
delete from 학생 where 성별 = '남';
select * from 학생;
ROLLBACK;
select * from 학생;
```



2. 자동완료 트랜잭션 : SQL 문 하나를 독립된 하나의 트랜잭션으로 자동 정의하고 SQL문의 실행 결과에 따라 자동으로 커밋 또는 로백하는 트랜잭션
   - 기본모드의 트랜잭션, 시스템 트랜잭션

```mysql
# 자동완료 트랜잭션의 설정
select @@AUTOCOMMIT;
SET AUTOCOMMIT = 1;
```

```mysql
#자동완료 트랜잭션의 예
insert into 과목 values('1','2','3','4');
select * from 과목;
ROLLBACK;
select * from 과목;
```

3. 수동완료 트랜잭션 : 트랜잭션의 끝만 사용자가 직접 명시적으로 지정하는 트랜잭션
   - 암시적 트랜잭션

```mysql
# 수동완료 트랜잭션의 설정
select @@AUTOCOMMIT ; 
SET AUTOCOMMIT = 0;
```

```mysql
# 수동완료 트랜잭션의 예
delete from 과목 where 이름 = '연극학개론';
select * from 과목;
insert into 과목 values('c008','독서와토론','111','교양','2');
select * from 과목;
ROLLBACK;
select * from 과목;
SET AUTOCOMMIT = 0;
```





